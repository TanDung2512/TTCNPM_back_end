<% include ../partials/header.ejs %>
    <% include ../partials/sidebar.ejs %>
    <style>
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 40%; 
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        input[type=text], select, textarea {
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; 
            margin-top: 6px; 
            margin-bottom: 16px; 
            resize: vertical
        }

        input[type=number]{
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; 
            margin-top: 6px; 
            margin-bottom: 16px; 
            resize: vertical
        }

        input[type=button] {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type=button]:hover {
            background-color: #45a049;
        }
    </style>
    <div class="pusher">
        <% include ../partials/navbar.ejs %>
            <script>
                let xmlhttp = new XMLHttpRequest()
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        let pagination = document.getElementById("paginate-product")
                        let leftArrow = document.createElement("a")
                        let leftIcon = document.createElement("i")
                        leftIcon.className += "left chevron icon"
                        leftArrow.className += "icon item"
                        leftArrow.appendChild(leftIcon)
                        let rightArrow = document.createElement("a")
                        let rightIcon = document.createElement("i")
                        rightIcon.className += "right chevron icon"
                        rightArrow.className += "icon item"
                        rightArrow.appendChild(rightIcon)
                        pagination.appendChild(leftArrow)
                        let response = JSON.parse(this.responseText)
                        for(i = 1; i<=response.numOfPages; i++)
                        {
                            let item = document.createElement('a')
                            // if(i==1) {
                            //     item.className += "item active"
                            // } else {
                                
                            // }
                            item.className += "item"
                            let number = document.createTextNode(i)
                            item.onclick = function(){
                                changeData(parseInt(number.nodeValue, 10))
                            }
                            item.appendChild(number)
                            pagination.appendChild(item)
                        }
                        pagination.appendChild(rightArrow)
                    }
                }
                xmlhttp.open("GET", "http://localhost:3003/products", true)
                xmlhttp.send()
                let xml = new XMLHttpRequest()
                xml.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        let response = JSON.parse(this.responseText)
                        let table, item, id, name, type, brand, category, price, amount
                        table = document.getElementById('table')
                        for(let i = 0; i<response.length; i++)
                        {
                            item = document.createElement('tr')
                            id = document.createElement('td')
                            name = document.createElement('td')
                            type = document.createElement('td')
                            brand = document.createElement('td')
                            category = document.createElement('td')
                            price = document.createElement('td')
                            amount = document.createElement('td')
                            id.appendChild(document.createTextNode(response.data[i].product_id))
                            name.appendChild(document.createTextNode(response.data[i].product_name))
                            type.appendChild(document.createTextNode(response.data[i].product_type))
                            brand.appendChild(document.createTextNode(response.data[i].product_brand))
                            category.appendChild(document.createTextNode(response.data[i].product_category))
                            price.appendChild(document.createTextNode(response.data[i].product_price))
                            amount.appendChild(document.createTextNode(response.data[i].product_amount))
                            item.appendChild(id)
                            item.appendChild(name)
                            item.appendChild(type)
                            item.appendChild(brand)
                            item.appendChild(category)
                            item.appendChild(price)
                            item.appendChild(amount)
                            table.appendChild(item)
                        }
                    }
                }
                xml.open("GET", "http://localhost:3003/products/page/1", true)
                xml.send()

                function changeData(index) {
                    // change active status
                    // let pagination = document.getElementById("paginate-product")
                    // let pageList = pagination.getElementsByClassName("item")
                    // var current = pageList.getElementsByClassName("active")[0]
                    // current.className = current.className.replace(" active", "");
                    // className += " active";

                    document.getElementById('table').innerHTML = ''
                    let xml = new XMLHttpRequest()
                    xml.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            let response = JSON.parse(this.responseText)
                            let table, item, id, name, type, brand, category, price, amount
                            table = document.getElementById('table')
                            for(let i = 0; i<response.length; i++)
                            {
                                item = document.createElement('tr')
                                id = document.createElement('td')
                                name = document.createElement('td')
                                type = document.createElement('td')
                                brand = document.createElement('td')
                                category = document.createElement('td')
                                price = document.createElement('td')
                                amount = document.createElement('td')
                                id.appendChild(document.createTextNode(response.data[i].product_id))
                                name.appendChild(document.createTextNode(response.data[i].product_name))
                                type.appendChild(document.createTextNode(response.data[i].product_type))
                                brand.appendChild(document.createTextNode(response.data[i].product_brand))
                                category.appendChild(document.createTextNode(response.data[i].product_category))
                                price.appendChild(document.createTextNode(response.data[i].product_price))
                                amount.appendChild(document.createTextNode(response.data[i].product_amount))
                                item.appendChild(id)
                                item.appendChild(name)
                                item.appendChild(type)
                                item.appendChild(brand)
                                item.appendChild(category)
                                item.appendChild(price)
                                item.appendChild(amount)
                                table.appendChild(item)
                            }
                        }
                    }
                    xml.open("GET", `http://localhost:3003/products/page/${index}`, true)
                    xml.send()
                }

                function search() {
                    document.getElementById('table').innerHTML = ''
                    document.getElementById("paginate-product").innerHTML = ''
                    let pagination = document.getElementById("paginate-product")
                    let leftArrow = document.createElement("a")
                    let leftIcon = document.createElement("i")
                    leftIcon.className += "left chevron icon"
                    leftArrow.className += "icon item"
                    leftArrow.appendChild(leftIcon)
                    let rightArrow = document.createElement("a")
                    let rightIcon = document.createElement("i")
                    rightIcon.className += "right chevron icon"
                    rightArrow.className += "icon item"
                    rightArrow.appendChild(rightIcon)
                    pagination.appendChild(leftArrow)
                    let item = document.createElement('a')
                    item.className += "item"
                    let number = document.createTextNode(1)
                    item.onclick = function(){
                        changeData(parseInt(number.nodeValue, 10))
                    }
                    item.appendChild(number)
                    pagination.appendChild(item)
                    pagination.appendChild(rightArrow)
                    let search = document.getElementById("searchBar").value
                    let xml = new XMLHttpRequest()
                    xml.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            let response = JSON.parse(this.responseText)
                            let table, item, id, name, type, brand, category, price, amount
                            table = document.getElementById('table')
                            for(let i = 0; i<response.length; i++)
                            {
                                item = document.createElement('tr')
                                id = document.createElement('td')
                                name = document.createElement('td')
                                type = document.createElement('td')
                                brand = document.createElement('td')
                                category = document.createElement('td')
                                price = document.createElement('td')
                                amount = document.createElement('td')
                                id.appendChild(document.createTextNode(response.data[i].product_id))
                                name.appendChild(document.createTextNode(response.data[i].product_name))
                                type.appendChild(document.createTextNode(response.data[i].product_type))
                                brand.appendChild(document.createTextNode(response.data[i].product_brand))
                                category.appendChild(document.createTextNode(response.data[i].product_category))
                                price.appendChild(document.createTextNode(response.data[i].product_price))
                                amount.appendChild(document.createTextNode(response.data[i].product_amount))
                                item.appendChild(id)
                                item.appendChild(name)
                                item.appendChild(type)
                                item.appendChild(brand)
                                itemmodalButton.appendChild(category)
                                itemmodalButton.appendChild(price)
                                itemmodalButton.appendChild(amount)
                                tablmodalButtone.appendChild(item)
                            }
                        }
                    }
                    xml.open("GET", `http://localhost:3003/products/search/${search}`, true)
                    xml.send()
                }

                window.onclick = function(event) {
                    let modal = document.getElementById("myModal");
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }

                function closeModal() {
                    let modal = document.getElementById("myModal");
                    modal.style.display = "none";
                }

                function showModal() {
                    let modal = document.getElementById("myModal");
                    modal.style.display = "block";
                }

                function createProduct() {
                    let request = {
                        name: document.getElementById('pname').value,
                        type: document.getElementById('ptype').value,
                        brand: document.getElementById('pbrand').value,
                        category: document.getElementById('pcategory').value,
                        amount: document.getElementById('pamount').value,
                        price: document.getElementById('pprice').value,
                        desc: document.getElementById('desc').value,
                    }
                    let xml = new XMLHttpRequest()
                    xml.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            alert(this.responseText)
                        }
                    }
                    xml.open("POST", `http://localhost:3003/products/create`)
                    xml.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                    xml.send(JSON.stringify(request))
                }
            </script>
        <div class="custom-container" id="product-page">
            <section class="ui segment" id="product-management">
                <!-- Header -->
                <div class="ui row">
                    <h1 class="ui horizontal divider header">PRODUCT MANAGEMENT</h1>
                </div>
                <!-- /Header -->

                <!-- Search box and Add button -->
                <div class="ui row">
                    <div class="ui grid"5>
                        <div class="eight wide column">
                            <button type="button" class="ui grey basic button" id="modalButton" onclick="showModal()">
                                Create new product &nbsp;
                                <i class="box icon"> </i>
                            </button>
                        </div>
                        <div id="myModal" class="modal">

                            <!-- Modal content -->
                            <div class="modal-content">
                                <span class="close" onclick="closeModal()">&times;</span>
                                <div class="ui row">
                                    <br>
                                    <h3 class="ui horizontal divider header">CREATE PRODUCT</h3>
                                </div>
                                <form>
                                    <label for="pname">Product Name</label>
                                    <input type="text" id="pname" name="pname" placeholder="Product name..">
                                
                                    <label for="ptype">Product Type</label>
                                    <input type="text" id="ptype" name="ptype" placeholder="Product type..">

                                    <label for="pbrand">Product Brand</label>
                                    <input type="text" id="pbrand" name="pbrand" placeholder="Product brand..">

                                    <label for="pcategory">Product Category</label>
                                    <input type="text" id="pcategory" name="pcategory" placeholder="Product category..">
                                
                                    <label for="pamount">Product Amount</label>
                                    <input type="number" id="pamount" name="pamount" placeholder="Product amount..">

                                    <label for="pprice">Product Price</label>
                                    <input type="number" id="pprice" name="pprice" placeholder="Product price..">

                                    <label for="desc">Description</label>
                                    <textarea id="desc" name="desc" placeholder="Product description.." style="height:200px"></textarea>
                                
                                    <input type="button" value="Create" onclick="createProduct()">
                                </form>
                            </div>
                        
                        </div>
                        <div class="eight wide right floated column" >
                            <div class="ui icon fluid input">
                                <input id="searchBar" type="text" placeholder="Search product by name..." onchange="search()">
                                <i class="inverted circular search link icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Search box and Add button -->

                <!-- Table -->
                <div class="ui row" id="user-table">
                    <table class="ui celled padded table">
                        <thead>
                            <tr>
                                <th class="center aligned">ID</th>
                                <th class="center aligned">Name</th>
                                <th class="center aligned">Type</th>
                                <th class="center aligned">Brand</th>
                                <th class="center aligned single line">Category</th>
                                <th class="center aligned single line">Amount</th>
                                <th class="center aligned single line">Price</th>
                            </tr>
                        </thead>
                        <tbody id="table">
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="8">
                                    <div class="ui right floated pagination menu" id="paginate-product">
                                    </div>
                                </th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <!-- Table -->

            </section>
        </div>
        
<% include ../partials/footer.ejs %>